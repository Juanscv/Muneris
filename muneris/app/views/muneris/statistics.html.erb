<h1>Statistics</h1>

<% define_grid(@bills_grid, hide_submit_button: true) do |g|

  g.blank_slate  partial: 'layouts/partials/blank', locals: { what: 'bill' }

  g.action_column

  g.column name: 'Consumption', attribute: 'consumption', model: 'Bill', auto_reload:  true, detach_with_id: :consumption_filter do |b|
    case b.bill.service
    when 1
      b.bill.consumption.to_s + " kWh" if b.bill
    when 2
      b.bill.consumption.to_s + " m3" if b.bill
    when 3
      b.bill.consumption.to_s + " m3" if b.bill
    end
  end

  g.column  name: 'Payment', attribute: 'value', model: 'Bill', auto_reload:  true, detach_with_id: :value_filter do |b|
    number_to_currency(b.bill.value, :precision => 0) if b.bill
  end

  g.column name: 'Type of bill', attribute: 'service', model: 'Bill', auto_reload: true, detach_with_id: :service_filter, custom_filter: [['Energy Bill',1],['Water Bill',2],['Gas Bill',3]] do |b|
    case b.bill.service
    when 1
      "Energy"
    when 2
      "Water"
    when 3
      "Gas"
    end
  end

  g.column name: 'Classification', attribute: 'tariff', model: 'User', auto_reload: true, custom_filter: ["Residencial Estrato 1", "Residencial Estrato 2", "Residencial Estrato 3", "Residencial Estrato 4", "Residencial Estrato 5", "Residencial Estrato 6", "Oficial Nivel 1", "Oficial Nivel 2", "Comercial Nivel 1", "Comercial Nivel 2"], detach_with_id: :tariff_filter do |u|
  	u.user.tariff if u.user
  end

  g.column name: 'Address', attribute: 'address', model: 'User', auto_reload: true, detach_with_id: :address_filter do |u|
  	u.user.address if u.user
  end

  g.column name: 'Locale', attribute: 'locale', model: 'User', auto_reload: true, detach_with_id: :locale_filter do |u|
  	u.user.locale if u.user
  end	  
 
end %>

<div class="w-container">

  <div class="w-row">
    <div class="w-col w-col-3">
      <div class ="wg-detached-filter">
        <div>Consumption: <%= grid_filter @bills_grid, :consumption_filter %></div>
        
        <div>Payment:  <%= grid_filter @bills_grid, :value_filter %></div>

        <div>Type of bill:  <%= grid_filter @bills_grid, :service_filter %></div>

        <div>Classification:	<%= grid_filter @bills_grid, :tariff_filter %></div>

		<div>Address:	<%= grid_filter @bills_grid, :address_filter %></div>
				
		<div>Locale:	<%= grid_filter @bills_grid, :locale_filter %></div>

        <div class="external-buttons w-container">
          	<button class="clickable btn w-button" data-grid-name="grid">Reset</button>
        </div>
      </div>
      <div class="w-row">
        <div class="w-col w-col-2">
          <%= link_to image_tag("add.png"), new_bill_path %>
        </div>
        <div class="w-col w-col-10">
          <h4><%= link_to 'New Bill', new_bill_path, class: "profile-sections" %></h4>
        </div>        
      </div>
    </div>
    <div class="w-col w-col-8">
      <div class="wice-grid">
      <br>
        <%= render_grid(@bills_grid) %>
      </div>
    </div>
  </div>
</div>